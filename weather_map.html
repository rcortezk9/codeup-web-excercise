<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Weather Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="css/weather_map.css">

</head>
<body>
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header navbar-right">
            <form class="navbar-form navbar-left">
                <div class="form-group">
                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                    <input type="text" class="form-control" placeholder="Enter City">
                </div>
                <button type="submit" class="btn btn-default">Search</button>
            </form>
        </div>
    </div>
</nav>
<div class="container-fluid">
    <h1>Weather Application</h1>
    <h2 id="cityName"></h2>

    <div class="row">
        <div class="col-xs-6 col-md-3" id="day0">
            <a href="#" class="thumbnail"></a>
        </div>
        <div class="col-xs-6 col-md-3" id="day1">
            <a href="#" class="thumbnail"></a>
        </div>
        <div class="col-xs-6 col-md-3" id="day2">
            <a href="#" class="thumbnail"></a>
        </div>
    </div>

    <div id="map-display" style="height: 400px;"></div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBe0814nG-IxIgG0VMjMJ6jmU1__W1TFGQ"></script>

<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script>
    $(document).ready(function(){
        'use strict';
        var lat = 29.4241;
        var lon = -98.4636;
        var mapOptions = {
            zoom: 5,
            center: {
                lat: lat,
                lng: lon
            },
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        // Render the map
        var map = new google.maps.Map(document.getElementById("map-display"), mapOptions);
        //draggable marker
        var marker = new google.maps.Marker({
            position: {
                lat: lat,
                lng: lon
            },
            map: map,
            draggable: true
        });

        // Function to convert output to title case
        function titleCase(str) {
            str = str.toLowerCase().split(' ');
            for (var i = 0; i < str.length; i++) {
                str[i] = str[i].charAt(0).toUpperCase() + str[i].slice(1);
            }
            return str.join(' ');
        }

        function getWeather(lat, lon) {
            $.get("http://api.openweathermap.org/data/2.5/forecast/daily", {
                APPID: "55aec6780da8e9b516e2937ae17b58af",
                lat: lat,
                lon: lon,
                units: "imperial",
                cnt: 3
            }).done(function (data) {
            console.log(data);
                data.list.forEach(function (element, index) {
//            console.log(element);

                    var content = "";

                    content += '<span id="temp">' + parseInt(element.temp.max) + '&deg;' + '/' + parseInt(element.temp.min) + '&deg;</span>';
                    content += '<br><img src="http://openweathermap.org/img/w/' + element.weather[0].icon + '.png">';
                    content += '<br><span>Clouds:</span>' + ' ' + titleCase(element.weather[0].description);
                    content += '<br><span>Humidity:</span>' + ' ' + element.humidity + '%';
                    content += '<br><span>Wind:</span>' + ' ' + element.speed + ' ' + 'mph/' + element.deg + '&deg;';
                    content += '<br><span>Pressure:</span>' + ' ' + element.pressure;

                    $('#day' + index).html(content);

                });
                var cityName = data.city.name;
                $('#cityName').text(cityName);
            });
        }
        marker.addListener('dragend', function(event) {
            lat = event.latLng.lat();
            lon = event.latLng.lng();
            mapOptions.center.lng = lon;
            mapOptions.center.lat = lat;
            getWeather(lat, lon);
        });

        getWeather(lat, lon);

    });
</script>

</body>
</html>